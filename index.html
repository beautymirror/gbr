<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Beauty Ranking | Get Your AI Beauty Rank Score</title>
    <meta name="description" content="Discover your place in the world beauty ranking. Our AI analyzes your photo to provide an objective beauty rank. Get your score now!">
    <meta name="keywords" content="beauty ranking, beauty rank, world beauty ranking, ai beauty analysis, objective score, facial analysis">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F9FAFB;
            position: relative;
        }
        /* Animated Gradient Background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 200%;
            height: 200%;
            z-index: -1;
            background: radial-gradient(circle at 20% 20%, #e9d5ff, transparent 30%),
                        radial-gradient(circle at 80% 70%, #d1fae5, transparent 35%),
                        radial-gradient(circle at 50% 90%, #fbcfe8, transparent 40%);
            animation: gradient-flow 25s ease-in-out infinite;
        }
        @keyframes gradient-flow {
            0% { transform: translate(0, 0); }
            50% { transform: translate(-25%, -25%); }
            100% { transform: translate(0, 0); }
        }
        .logo-gradient-text {
            background: linear-gradient(90deg, #D946EF, #8B5CF6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .cta-button {
            background: linear-gradient(90deg, #D946EF, #8B5CF6);
            color: white;
            transition: all 0.3s ease-in-out;
        }
        .cta-button:hover {
            box-shadow: 0 10px 25px -5px rgba(139, 92, 246, 0.5), 0 0 15px rgba(217, 70, 239, 0.3);
            transform: translateY(-3px) scale(1.05);
        }
        .clean-card {
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 1.25rem; /* 20px */
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05);
            border: 1px solid #E5E7EB;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .tab-button.active {
            color: #8B5CF6;
            box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            background-color: white;
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .chart-bar-bg {
            background-color: #f3f4f6;
            border-radius: 9999px;
            height: 0.75rem;
            flex-grow: 1;
            margin: 0 0.75rem;
        }
        .chart-bar {
            background: linear-gradient(90deg, #D946EF, #8B5CF6);
            height: 100%;
            border-radius: 9999px;
            width: 0;
            transition: width 1.5s cubic-bezier(0.25, 1, 0.5, 1);
        }
        /* Marquee styles */
        .marquee {
            overflow: hidden;
            position: relative;
            width: 100%;
            -webkit-mask-image: linear-gradient(to right, transparent, white 20%, white 80%, transparent);
            mask-image: linear-gradient(to right, transparent, white 20%, white 80%, transparent);
        }
        .marquee-content {
            display: flex;
            width: max-content;
            animation: marquee 30s linear infinite;
        }
        .marquee-content.reverse {
            animation-direction: reverse;
        }
        @keyframes marquee {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        /* Scroll Animation */
        .reveal {
            opacity: 0;
            transform: translateY(50px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
        }
        .reveal.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .ranking-item.hidden {
            display: none;
        }
    </style>
</head>
<body class="text-gray-900">

    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 border-b border-gray-200">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="index.html">
                <img src="logo.svg" alt="Global Beauty Rank Logo" class="h-16">
            </a>
            <nav class="hidden md:flex items-center space-x-8">
                <a href="#how-it-works" class="text-gray-600 hover:text-purple-600 transition font-medium">How It Works</a>
                <a href="#ratings" class="text-gray-600 hover:text-purple-600 transition font-medium">Rankings</a>
                <a href="#faq" class="text-gray-600 hover:text-purple-600 transition font-medium">FAQ</a>
            </nav>
            <a href="quiz.html" class="cta-button font-semibold px-6 py-2.5 rounded-lg">
                Get Your Score
            </a>
        </div>
    </header>

    <main>
        <!-- ИЗМЕНЕНИЕ: Добавлен новый блок со счетчиком -->
        <section class="py-12 bg-white/50">
            <div class="container mx-auto px-6">
                <div class="text-center">
                    <p class="text-5xl md:text-6xl font-black text-purple-600" id="participant-counter">5,467,789</p>
                    <p class="mt-2 text-lg text-gray-600">participants from <span id="country-counter" class="font-bold">163</span> countries</p>
                </div>
            </div>
        </section>

        <section class="relative py-24 md:py-32 overflow-hidden">
            <div class="container mx-auto px-6 text-center relative z-10">
                <h1 class="text-5xl md:text-7xl font-black text-gray-900 leading-tight tracking-tighter">
                    Find out your place in the <span class="logo-gradient-text">world beauty ranking</span>
                </h1>
                <p class="mt-6 text-lg md:text-xl text-gray-600 max-w-3xl mx-auto">
                    Simply upload your photo to get your AI beauty rank. We use advanced technology to provide an objective score based on dozens of facial parameters.
                </p>
                <div class="mt-10">
                    <a href="quiz.html" class="cta-button font-bold text-lg px-8 py-4 rounded-xl shadow-lg shadow-purple-500/10 inline-flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                        Start The Analysis
                    </a>
                </div>
            </div>
        </section>

        <section class="py-20 space-y-4">
            <div class="text-center mb-8 reveal">
                <h2 class="text-3xl font-bold tracking-tighter">Recent Beauty Rank Analyses</h2>
                <p class="text-gray-500 mt-1">See who just got their beauty score.</p>
            </div>
            <div class="marquee">
                <div class="marquee-content" id="marquee-1">
                    </div>
            </div>
            <div class="marquee">
                <div class="marquee-content reverse" id="marquee-2">
                   </div>
            </div>
        </section>

        <section id="how-it-works" class="py-24 bg-white/50 backdrop-blur-md">
            <div class="container mx-auto px-6">
                <div class="text-center mb-16 reveal">
                    <h2 class="text-4xl md:text-5xl font-extrabold tracking-tighter">How Our Beauty Ranking Works</h2>
                    <p class="mt-3 text-gray-600 max-w-2xl mx-auto">Get your objective beauty score in three easy steps.</p>
                </div>
                <div class="max-w-3xl mx-auto">
                    <div class="space-y-8 md:space-y-4">
                        <div class="sticky top-24 z-10 reveal">
                            <div class="clean-card p-8 md:p-10 flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-6">
                                <div class="flex-shrink-0">
                                    <lottie-player src="upload.json" background="transparent" speed="1" style="width: 120px; height: 120px;" loop autoplay></lottie-player>
                                </div>
                                <div>
                                    <p class="text-sm font-bold text-purple-600 uppercase">Step 1</p>
                                    <h3 class="text-2xl font-bold mt-1">Upload Your Photo</h3>
                                    <p class="mt-2 text-gray-600">Select a clear, well-lit selfie for the most accurate beauty rank analysis.</p>
                                </div>
                            </div>
                        </div>
                        <div class="sticky top-32 z-20 reveal">
                           <div class="clean-card p-8 md:p-10 flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-6">
                                <div class="flex-shrink-0">
                                    <lottie-player src="analysis.json" background="transparent" speed="1" style="width: 120px; height: 120px;" loop autoplay></lottie-player>
                                </div>
                                <div>
                                    <p class="text-sm font-bold text-purple-600 uppercase">Step 2</p>
                                    <h3 class="text-2xl font-bold mt-1">AI-Powered Analysis</h3>
                                    <p class="mt-2 text-gray-600">Our neural network analyzes your photo across 128 facial parameters for your beauty ranking.</p>
                                </div>
                            </div>
                        </div>
                        <div class="sticky top-40 z-30 reveal">
                            <div class="clean-card p-8 md:p-10 flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-6">
                                <div class="flex-shrink-0">
                                    <lottie-player src="result.json" background="transparent" speed="1" style="width: 120px; height: 120px;" loop autoplay></lottie-player>
                                </div>
                                <div>
                                    <p class="text-sm font-bold text-purple-600 uppercase">Step 3</p>
                                    <h3 class="text-2xl font-bold mt-1">Get Your Results</h3>
                                    <p class="mt-2 text-gray-600">Receive your personal score and discover your position in the world beauty ranking.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="ratings" class="py-20">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12 reveal">
                    <h2 class="text-4xl md:text-5xl font-extrabold tracking-tighter">World Beauty Ranking & Statistics</h2>
                    <p class="mt-3 text-gray-600 max-w-2xl mx-auto">Explore the data and see where your beauty rank fits in.</p>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 reveal">
                    <div class="lg:col-span-2 clean-card p-6 md:p-8 flex flex-col">
                        <div class="p-1.5 bg-gray-100 rounded-xl flex items-center mb-6" id="main-tabs-nav">
                            <button data-tab-target="#world" class="tab-button w-full text-center font-semibold py-2.5 rounded-lg transition active">World</button>
                            <button data-tab-target="#countries" class="tab-button w-full text-center font-semibold py-2.5 rounded-lg transition">Countries</button>
                            <button data-tab-target="#men" class="tab-button w-full text-center font-semibold py-2.5 rounded-lg transition">Men</button>
                            <button data-tab-target="#women" class="tab-button w-full text-center font-semibold py-2.5 rounded-lg transition">Women</button>
                        </div>
                        <div id="main-tabs-content">
                            </div>
                        <div class="pt-4 text-center border-t border-gray-100 mt-4">
                            <button id="see-more-rankings" class="text-sm font-semibold text-purple-600 hover:text-purple-800 transition-colors">See more</button>
                        </div>
                    </div>
                    <div class="space-y-8" id="statistics-cards">
                        </div>
                </div>
            </div>
        </section>

        <section id="faq" class="py-20 bg-white/50 backdrop-blur-md">
            <div class="container mx-auto px-6 max-w-3xl reveal">
                <div class="text-center mb-12">
                    <h2 class="text-4xl md:text-5xl font-extrabold tracking-tighter">Beauty Rank FAQ</h2>
                </div>
                <div class="space-y-4">
                    <div class="clean-card"><details class="p-6 cursor-pointer group"><summary class="font-semibold text-lg flex justify-between items-center">How accurate is the AI beauty ranking analysis?<span class="text-purple-500 transition group-open:rotate-45">+</span></summary><p class="mt-4 text-gray-600">Our AI is trained on a massive dataset of diverse images to analyze objective facial metrics like symmetry and proportions. While it provides a consistent, data-driven score, remember that beauty is deeply personal and subjective. Consider our ranking a fun, technological perspective, not a final judgment.</p></details></div>
                    <div class="clean-card"><details class="p-6 cursor-pointer group"><summary class="font-semibold text-lg flex justify-between items-center">Are my photos and data secure?<span class="text-purple-500 transition group-open:rotate-45">+</span></summary><p class="mt-4 text-gray-600">Absolutely. <strong>Your privacy is our top priority.</strong> Your photo is used for the one-time analysis and is <strong>deleted immediately</strong> from our servers. We never store or share your images. The only data we keep for statistical rankings (like your first name and country) is anonymized.</p></details></div>
                    <div class="clean-card"><details class="p-6 cursor-pointer group"><summary class="font-semibold text-lg flex justify-between items-center">What exactly does the AI analyze?<span class="text-purple-500 transition group-open:rotate-45">+</span></summary><p class="mt-4 text-gray-600">The AI evaluates dozens of objective parameters. This includes facial symmetry, the 'golden ratio,' skin clarity (texture, not color), and the proportions between different facial features like eyes, nose, and mouth. It's a purely geometric and textural analysis.</p></details></div>
                    <div class="clean-card"><details class="p-6 cursor-pointer group"><summary class="font-semibold text-lg flex justify-between items-center">Can I use a photo with glasses or other people?<span class="text-purple-500 transition group-open:rotate-45">+</span></summary><p class="mt-4 text-gray-600">For the most accurate results, please use a clear, forward-facing photo of just yourself, without glasses, hats, or heavy shadows. Obstructions can interfere with the AI's ability to analyze your facial features correctly.</p></details></div>
                    <div class="clean-card"><details class="p-6 cursor-pointer group"><summary class="font-semibold text-lg flex justify-between items-center">Why isn't this service free?<span class="text-purple-500 transition group-open:rotate-45">+</span></summary><p class="mt-4 text-gray-600">Running a sophisticated AI model requires significant computational resources. The small service fee allows us to cover these costs, maintain the technology, and ensure the service remains ad-free and secure, without ever needing to sell user data.</p></details></div>
                    <div class="clean-card"><details class="p-6 cursor-pointer group"><summary class="font-semibold text-lg flex justify-between items-center">What do I receive after the analysis?<span class="text-purple-500 transition group-open:rotate-45">+</span></summary><p class="mt-4 text-gray-600">You'll receive your unique score on a 10-point scale, a brief AI-generated comment on your photo's strengths, and your anonymous placement in our global, country, and gender-based rankings.</p></details></div>
                </div>
            </div>
        </section>
    </main>

    <footer class="border-t border-gray-200 bg-white">
        <div class="container mx-auto px-6 py-8 text-center text-gray-600">
            <a href="index.html">
                <img src="logo.svg" alt="Global Beauty Rank Logo" class="h-16 mx-auto mb-4">
            </a>
            <p class="font-semibold">&copy; 2024 Global Beauty Rank. All rights reserved.</p>
            <p class="text-sm mt-2">Please take the results with a sense of humor. Beauty is subjective.</p>
            <div class="mt-4 text-sm">
                <a href="terms.html" class="text-gray-500 hover:text-gray-700 hover:underline">Terms of Service</a>
                <span class="mx-2 text-gray-400">·</span>
                <a href="policy.html" class="text-gray-500 hover:text-gray-700 hover:underline">Privacy Policy</a>
            </div>
        </div>
    </footer>

    <div id="cookie-consent-banner" class="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-lg p-4 border-t border-gray-200 z-[60] transform translate-y-full transition-transform duration-500 ease-in-out">
        <div class="container mx-auto flex flex-col sm:flex-row items-center justify-between gap-4">
            <p class="text-sm text-gray-700 text-center sm:text-left">We use cookies to ensure you get the best experience on our website. By continuing to use our site, you agree to our <a href="policy.html" class="underline hover:text-purple-600">Privacy Policy</a>.</p>
            <button id="accept-cookies" class="cta-button font-semibold px-5 py-2 rounded-lg flex-shrink-0">Accept</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, query, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD9R43D9ktWxYFQtpkGJNTOgdWyZqfM-bU",
            authDomain: "global-beauty-rank.firebaseapp.com",
            projectId: "global-beauty-rank",
            storageBucket: "global-beauty-rank.firebasestorage.app",
            messagingSenderId: "916586590476",
            appId: "1:916586590476:web:039be613c177dc46491929",
            measurementId: "G-KPWTDXMHF"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        document.addEventListener('DOMContentLoaded', () => {
            const statsData = {
                professions: { title: 'Top Professions', items: [ { label: 'Artist', score: 9.4 }, { label: 'Model', score: 9.3 }, { label: 'Doctor', score: 9.1 }, { label: 'Engineer', score: 8.9 }, { label: 'Teacher', score: 8.8 }, { label: 'Musician', score: 8.7 }, { label: 'Athlete', score: 8.6 }, { label: 'Programmer', score: 8.5 }, { label: 'Manager', score: 8.3 }, { label: 'Salesperson', score: 8.1 } ] },
                womenByAge: { title: 'Top Age Group (Women)', items: [ { label: '18-25', score: 9.3 }, { label: '25-35', score: 9.1 }, { label: '< 18', score: 8.9 }, { label: '36-44', score: 8.7 }, { label: '45-59', score: 8.4 }, { label: '60+', score: 8.2 } ] },
                menByAge: { title: 'Top Age Group (Men)', items: [ { label: '18-25', score: 9.0 }, { label: '25-35', score: 8.9 }, { label: '< 18', score: 8.8 }, { label: '36-44', score: 8.6 }, { label: '45-59', score: 8.3 }, { label: '60+', score: 8.1 } ] }
            };

            function getCountryCode(countryName) {
                const countryMap = {"Afghanistan":"af","Albania":"al","Algeria":"dz","American Samoa":"as","Andorra":"ad","Angola":"ao","Anguilla":"ai","Antarctica":"aq","Antigua and Barbuda":"ag","Argentina":"ar","Armenia":"am","Aruba":"aw","Australia":"au","Austria":"at","Azerbaijan":"az","Bahamas":"bs","Bahrain":"bh","Bangladesh":"bd","Barbados":"bb","Belarus":"by","Belgium":"be","Belize":"bz","Benin":"bj","Bermuda":"bm","Bhutan":"bt","Bolivia":"bo","Bosnia and Herzegovina":"ba","Botswana":"bw","Brazil":"br","British Indian Ocean Territory":"io","British Virgin Islands":"vg","Brunei":"bn","Bulgaria":"bg","Burkina Faso":"bf","Burundi":"bi","Cambodia":"kh","Cameroon":"cm","Canada":"ca","Cape Verde":"cv","Cayman Islands":"ky","Central African Republic":"cf","Chad":"td","Chile":"cl","China":"cn","Christmas Island":"cx","Cocos (Keeling) Islands":"cc","Colombia":"co","Comoros":"km","Cook Islands":"ck","Costa Rica":"cr","Croatia":"hr","Cuba":"cu","Curaçao":"cw","Cyprus":"cy","Czechia":"cz","Denmark":"dk","Djibouti":"dj","Dominica":"dm","Dominican Republic":"do","DR Congo":"cd","Ecuador":"ec","Egypt":"eg","El Salvador":"sv","Equatorial Guinea":"gq","Eritrea":"er","Estonia":"ee","Eswatini (Swaziland)":"sz","Ethiopia":"et","Falkland Islands":"fk","Faroe Islands":"fo","Fiji":"fj","Finland":"fi","France":"fr","French Guiana":"gf","French Polynesia":"pf","French Southern and Antarctic Lands":"tf","Gabon":"ga","Gambia":"gm","Georgia":"ge","Germany":"de","Ghana":"gh","Gibraltar":"gi","Greece":"gr","Greenland":"gl","Grenada":"gd","Guadeloupe":"gp","Guam":"gu","Guatemala":"gt","Guernsey":"gg","Guinea":"gn","Guinea-Bissau":"gw","Guyana":"gy","Haiti":"ht","Honduras":"hn","Hong Kong":"hk","Hungary":"hu","Iceland":"is","India":"in","Indonesia":"id","Iran":"ir","Iraq":"iq","Ireland":"ie","Isle of Man":"im","Israel":"il","Italy":"it","Ivory Coast":"ci","Jamaica":"jm","Japan":"jp","Jersey":"je","Jordan":"jo","Kazakhstan":"kz","Kenya":"ke","Kiribati":"ki","Kosovo":"xk","Kuwait":"kw","Kyrgyzstan":"kg","Laos":"la","Latvia":"lv","Lebanon":"lb","Lesotho":"ls","Liberia":"lr","Libya":"ly","Liechtenstein":"li","Lithuania":"lt","Luxembourg":"lu","Macau":"mo","Madagascar":"mg","Malawi":"mw","Malaysia":"my","Maldives":"mv","Mali":"ml","Malta":"mt","Marshall Islands":"mh","Martinique":"mq","Mauritania":"mr","Mauritius":"mu","Mayotte":"yt","Mexico":"mx","Micronesia":"fm","Moldova":"md","Monaco":"mc","Mongolia":"mn","Montenegro":"me","Montserrat":"ms","Morocco":"ma","Mozambique":"mz","Myanmar":"mm","Namibia":"na","Nauru":"nr","Nepal":"np","Netherlands":"nl","New Caledonia":"nc","New Zealand":"nz","Nicaragua":"ni","Niger":"ne","Nigeria":"ng","Niue":"nu","Norfolk Island":"nf","North Korea":"kp","North Macedonia":"mk","Northern Mariana Islands":"mp","Norway":"no","Oman":"om","Pakistan":"pk","Palau":"pw","Palestine":"ps","Panama":"pa","Papua New Guinea":"pg","Paraguay":"py","Peru":"pe","Philippines":"ph","Pitcairn Islands":"pn","Poland":"pl","Portugal":"pt","Puerto Rico":"pr","Qatar":"qa","Republic of the Congo":"cg","Romania":"ro","Russia":"ru","Rwanda":"rw","Réunion":"re","Saint Barthélemy":"bl","Saint Helena Ascension and Tristan da Cunha":"sh","Saint Kitts and Nevis":"kn","Saint Lucia":"lc","Saint Martin":"mf","Saint Pierre and Miquelon":"pm","Saint Vincent and the Grenadines":"vc","Samoa":"ws","San Marino":"sm","Saudi Arabia":"sa","Senegal":"sn","Serbia":"rs","Seychelles":"sc","Sierra Leone":"sl","Singapore":"sg","Sint Maarten":"sx","Slovakia":"sk","Slovenia":"si","Solomon Islands":"sb","Somalia":"so","South Africa":"za","South Korea":"kr","South Sudan":"ss","Spain":"es","Sri Lanka":"lk","Sudan":"sd","Suriname":"sr","Svalbard and Jan Mayen":"sj","Sweden":"se","Switzerland":"ch","Syria":"sy","São Tomé and Príncipe":"st","Taiwan":"tw","Tajikistan":"tj","Tanzania":"tz","Thailand":"th","Timor-Leste":"tl","Togo":"tg","Tokelau":"tk","Tonga":"to","Trinidad and Tobago":"tt","Tunisia":"tn","Turkey":"tr","Turkmenistan":"tm","Turks and Caicos Islands":"tc","Tuvalu":"tv","Uganda":"ug","Ukraine":"ua","United Arab Emirates":"ae","United Kingdom":"gb","United States":"us","United States Minor Outlying Islands":"um","United States Virgin Islands":"vi","Uruguay":"uy","Uzbekistan":"uz","Vanuatu":"vu","Vatican City (Holy See)":"va","Venezuela":"ve","Vietnam":"vn","Wallis and Futuna":"wf","Western Sahara":"eh","Yemen":"ye","Zambia":"zm","Zimbabwe":"zw"};
                return countryMap[countryName] || 'un';
            }

            function formatTimeAgo(timestamp) {
                if (!timestamp?.seconds) return 'just now';
                const now = new Date();
                const past = new Date(timestamp.seconds * 1000);
                const diffInSeconds = Math.floor((now - past) / 1000);
                const diffInMinutes = Math.floor(diffInSeconds / 60);
                if (diffInMinutes < 1) return 'just now';
                if (diffInMinutes < 60) return `${diffInMinutes} min ago`;
                const diffInHours = Math.floor(diffInMinutes / 60);
                if (diffInHours < 24) return `${diffInHours}h ago`;
                const diffInDays = Math.floor(diffInHours / 24);
                return `${diffInDays}d ago`;
            }

            const mainQuery = query(collection(db, "rankings"));
            let fakeCounterStarted = false;

            onSnapshot(mainQuery, (snapshot) => {
                const allRankings = snapshot.docs.map(doc => doc.data());

                if (!fakeCounterStarted) {
                    startFakeCounter(allRankings.length);
                    fakeCounterStarted = true;
                }

                const uniqueCountries = new Set(allRankings.map(item => item.country).filter(Boolean));
                document.getElementById('country-counter').textContent = uniqueCountries.size;

                const sortedByTime = [...allRankings].sort((a, b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0));
                populateMarquees(sortedByTime.slice(0, 10));
                
                const sortedByScore = [...allRankings].sort((a, b) => b.score - a.score);
                populateRankings(sortedByScore);
            });

            function startFakeCounter(initialCount) {
                let participantCount = 5467789 + initialCount;
                const counterElement = document.getElementById('participant-counter');
                setInterval(() => {
                    participantCount += Math.floor(Math.random() * 5) + 1;
                    counterElement.textContent = participantCount.toLocaleString('en-US');
                }, 500);
            }

            function populateMarquees(data) {
                let cardHTML = '';
                data.forEach(item => {
                    const flagCode = getCountryCode(item.country);
                    const timeAgo = formatTimeAgo(item.timestamp);
                    cardHTML += `<div class="clean-card p-4 flex items-center space-x-4 mx-3 flex-shrink-0" style="width: 280px;"><img src="https://flagcdn.com/w80/${flagCode}.png" width="40" height="30" alt="Flag of ${item.country}" class="rounded-md"><div class="flex-grow"><p class="font-bold">${item.name}, ${item.age}</p><p class="text-sm text-gray-500">${timeAgo}</p></div><p class="text-2xl font-extrabold logo-gradient-text">${item.score.toFixed(1)}</p></div>`;
                });
                document.querySelectorAll('.marquee-content').forEach(container => {
                    container.innerHTML = cardHTML + cardHTML;
                });
            }
            
            function aggregateByCountry(rankings) {
                const countryScores = {};
                rankings.forEach(r => {
                    if (r.country && r.country !== 'Unknown') {
                        if (!countryScores[r.country]) {
                            countryScores[r.country] = { total: 0, count: 0 };
                        }
                        countryScores[r.country].total += r.score;
                        countryScores[r.country].count++;
                    }
                });
                return Object.keys(countryScores).map(country => ({
                    name: country,
                    score: countryScores[country].total / countryScores[country].count
                })).sort((a, b) => b.score - a.score);
            }

            function populateRankings(allRankings) {
                const rankingsData = {
                    world: allRankings,
                    countries: aggregateByCountry(allRankings),
                    men: allRankings.filter(r => r.gender === 'Male'),
                    women: allRankings.filter(r => r.gender === 'Female')
                };

                const container = document.getElementById('main-tabs-content');
                container.innerHTML = '';
                Object.keys(rankingsData).forEach((key, index) => {
                    const isActive = index === 0 ? 'active' : '';
                    let itemsHtml = '';
                    rankingsData[key].forEach((item, itemIndex) => {
                        const medals = ['medal-gold.svg', 'medal-silver.svg', 'medal-bronze.svg'];
                        const rankHtml = itemIndex < 3 ? `<img src="${medals[itemIndex]}" alt="Medal" class="w-6 h-6">` : `<span class="font-bold text-lg text-gray-400 w-6 text-center">${itemIndex + 1}</span>`;
                        const bgColor = itemIndex % 2 !== 0 ? 'bg-gray-50' : '';
                        const isHidden = itemIndex >= 7 ? 'hidden' : '';
                        const flagCode = getCountryCode(item.country || item.name);
                        const displayName = item.age ? `${item.name}, ${item.age}` : item.name;

                        itemsHtml += `<div class="flex items-center justify-between p-3 rounded-lg ${bgColor} ranking-item ${isHidden}"><div class="flex items-center space-x-4"><div class="w-6 text-center">${rankHtml}</div><img src="https://flagcdn.com/w40/${flagCode}.png" width="40" alt="Flag" class="rounded-sm"><div><div class="font-semibold">${displayName}</div></div></div><div class="font-bold text-lg text-purple-600">${item.score.toFixed(1)}/10</div></div>`;
                    });
                    container.innerHTML += `<div id="${key}" class="tab-content ${isActive} space-y-2">${itemsHtml}</div>`;
                });
            }
            
            const statsContainer = document.getElementById('statistics-cards');
            statsContainer.innerHTML = createStatsCard(statsData.professions) + createStatsCard(statsData.womenByAge) + createStatsCard(statsData.menByAge);

            function createStatsCard(data) {
                let itemsHtml = '';
                data.items.forEach((item, index) => {
                    const percentage = (item.score / 10) * 100;
                    const isHidden = index >= 3 ? 'hidden' : '';
                    itemsHtml += `<div class="flex items-center py-1 ${isHidden}" data-expandable><span class="w-24 text-sm font-medium text-gray-600">${item.label}</span><div class="chart-bar-bg"><div class="chart-bar" data-width="${percentage}%"></div></div><span class="w-10 text-right text-sm font-bold text-purple-600">${item.score.toFixed(1)}</span></div>`;
                });
                return `<div class="clean-card p-6 chart-container"><h3 class="font-bold text-xl mb-4">${data.title}</h3><div class="space-y-2">${itemsHtml}</div>${data.items.length > 3 ? '<button class="see-more-btn mt-4 text-sm font-semibold text-purple-600 hover:text-purple-800">See more</button>' : ''}</div>`;
            }

            document.getElementById('main-tabs-nav').addEventListener('click', (e) => {
                const button = e.target.closest('.tab-button');
                if (!button) return;
                document.querySelectorAll('#main-tabs-nav .tab-button').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                const target = document.querySelector(button.dataset.tabTarget);
                document.querySelectorAll('#main-tabs-content .tab-content').forEach(content => content.classList.remove('active'));
                if (target) target.classList.add('active');
            });

            document.querySelectorAll('.see-more-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const card = button.closest('.clean-card');
                    const hiddenItems = card.querySelectorAll('[data-expandable]');
                    const isExpanded = button.textContent === 'See less';
                    hiddenItems.forEach(item => item.classList.toggle('hidden', isExpanded));
                    button.textContent = isExpanded ? 'See more' : 'See less';
                });
            });

            const seeMoreRankingsBtn = document.getElementById('see-more-rankings');
            if (seeMoreRankingsBtn) {
                seeMoreRankingsBtn.addEventListener('click', () => {
                    const activeTab = document.querySelector('#main-tabs-content .tab-content.active');
                    if (!activeTab) return;
                    const hiddenItems = activeTab.querySelectorAll('.ranking-item.hidden');
                    const isExpanding = hiddenItems.length > 0;
                    if (isExpanding) {
                        hiddenItems.forEach(item => item.classList.remove('hidden'));
                        seeMoreRankingsBtn.textContent = 'See less';
                    } else {
                        activeTab.querySelectorAll('.ranking-item').forEach((item, index) => {
                            if (index >= 7) { item.classList.add('hidden'); }
                        });
                        seeMoreRankingsBtn.textContent = 'See more';
                    }
                });
            }

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        if (entry.target.classList.contains('chart-container')) {
                            entry.target.querySelectorAll('.chart-bar').forEach(bar => {
                                bar.style.width = bar.dataset.width;
                            });
                        }
                        entry.target.classList.add('visible');
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.15 });

            document.querySelectorAll('.reveal, .chart-container').forEach(el => {
                observer.observe(el);
            });

            const cookieBanner = document.getElementById('cookie-consent-banner');
            const acceptButton = document.getElementById('accept-cookies');
            if (cookieBanner && acceptButton) {
                if (!localStorage.getItem('cookiesAccepted')) {
                    setTimeout(() => {
                        cookieBanner.classList.remove('translate-y-full');
                    }, 1500);
                }
                acceptButton.addEventListener('click', () => {
                    localStorage.setItem('cookiesAccepted', 'true');
                    cookieBanner.classList.add('translate-y-full');
                });
            }
        });
    </script>

</body>
</html>
